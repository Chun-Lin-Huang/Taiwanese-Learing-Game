# æ‡¶è¼‰å…¥åŠŸèƒ½æ¸¬è©¦æŒ‡å—

## ğŸ“‹ æ¸¬è©¦æ¦‚è¦½

æœ¬æ¸¬è©¦å¥—ä»¶ç‚ºå°èªå­¸ç¿’éŠæˆ²çš„æ‡¶è¼‰å…¥åŠŸèƒ½æä¾›å…¨é¢çš„æ¸¬è©¦è¦†è“‹ï¼ŒåŒ…æ‹¬å–®å…ƒæ¸¬è©¦ã€æ•´åˆæ¸¬è©¦å’Œæ•ˆèƒ½æ¸¬è©¦ã€‚

## ğŸ§ª æ¸¬è©¦çµæ§‹

```
src/
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ setup.ts                    # æ¸¬è©¦ç’°å¢ƒè¨­ç½®
â”‚   â”œâ”€â”€ test-utils.tsx             # æ¸¬è©¦å·¥å…·å‡½æ•¸
â”‚   â”œâ”€â”€ performance.test.ts        # æ•ˆèƒ½æ¸¬è©¦
â”‚   â””â”€â”€ README.md                  # æœ¬æ–‡ä»¶
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ __tests__/
â”‚       â”œâ”€â”€ useIntersectionObserver.test.ts  # Intersection Observer Hook æ¸¬è©¦
â”‚       â”œâ”€â”€ useImagePreloader.test.ts        # åœ–ç‰‡é è¼‰å…¥ Hook æ¸¬è©¦
â”‚       â””â”€â”€ useNetworkStatus.test.ts         # ç¶²è·¯ç‹€æ…‹ Hook æ¸¬è©¦
â”œâ”€â”€ components/
â”‚   â””â”€â”€ __tests__/
â”‚       â””â”€â”€ LazyImage.test.tsx              # æ‡¶è¼‰å…¥åœ–ç‰‡çµ„ä»¶æ¸¬è©¦
â””â”€â”€ view/
    â””â”€â”€ __tests__/
        â””â”€â”€ ThemeSelectionPage.integration.test.tsx  # æ•´åˆæ¸¬è©¦
```

## ğŸš€ é‹è¡Œæ¸¬è©¦

### åŸºæœ¬å‘½ä»¤

```bash
# é‹è¡Œæ‰€æœ‰æ¸¬è©¦
npm run test

# é‹è¡Œæ¸¬è©¦ä¸¦ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
npm run test:coverage

# é‹è¡Œæ¸¬è©¦ UI ç•Œé¢
npm run test:ui

# ç›£è½æ¨¡å¼é‹è¡Œæ¸¬è©¦
npm run test:watch
```

### ç‰¹å®šæ¸¬è©¦

```bash
# åªé‹è¡Œæ‡¶è¼‰å…¥ç›¸é—œæ¸¬è©¦
npm run test:lazy-loading

# åªé‹è¡Œæ•´åˆæ¸¬è©¦
npm run test:integration

# åªé‹è¡Œæ•ˆèƒ½æ¸¬è©¦
npm run test:performance
```

## ğŸ”§ æ¸¬è©¦é¡å‹èªªæ˜

### 1. å–®å…ƒæ¸¬è©¦

**useIntersectionObserver Hook æ¸¬è©¦**
- æ¸¬è©¦ Hook çš„åˆå§‹åŒ–ç‹€æ…‹
- æ¸¬è©¦å…ƒç´ é€²å…¥/é›¢é–‹è¦–çª—çš„åµæ¸¬
- æ¸¬è©¦ `hasBeenSeen` ç‹€æ…‹çš„æŒä¹…æ€§
- æ¸¬è©¦æ¸…ç†æ©Ÿåˆ¶

**useImagePreloader Hook æ¸¬è©¦**
- æ¸¬è©¦åœ–ç‰‡é è¼‰å…¥åŠŸèƒ½
- æ¸¬è©¦å„ªå…ˆç´šé™åˆ¶
- æ¸¬è©¦éŒ¯èª¤è™•ç†
- æ¸¬è©¦ URL è®Šæ›´è™•ç†

**useNetworkStatus Hook æ¸¬è©¦**
- æ¸¬è©¦ä¸åŒç¶²è·¯é¡å‹åµæ¸¬
- æ¸¬è©¦æ…¢é€Ÿé€£æ¥åˆ¤æ–·
- æ¸¬è©¦ API ç¼ºå¤±æƒ…æ³è™•ç†

### 2. çµ„ä»¶æ¸¬è©¦

**LazyImage çµ„ä»¶æ¸¬è©¦**
- æ¸¬è©¦ä½”ä½ç¬¦é¡¯ç¤º
- æ¸¬è©¦éª¨æ¶å±è¼‰å…¥å‹•ç•«
- æ¸¬è©¦åœ–ç‰‡è¼‰å…¥æˆåŠŸ/å¤±æ•—
- æ¸¬è©¦æ·¡å…¥å‹•ç•«æ•ˆæœ
- æ¸¬è©¦ fallback åœ–ç‰‡æ©Ÿåˆ¶

### 3. æ•´åˆæ¸¬è©¦

**ThemeSelectionPage æ•´åˆæ¸¬è©¦**
- æ¸¬è©¦é é¢å®Œæ•´è¼‰å…¥æµç¨‹
- æ¸¬è©¦ API éŒ¯èª¤è™•ç†
- æ¸¬è©¦ä½¿ç”¨è€…äº’å‹•ï¼ˆé»æ“Šã€éµç›¤å°èˆªï¼‰
- æ¸¬è©¦ç¶²è·¯ç‹€æ³é©æ‡‰
- æ¸¬è©¦åœ–ç‰‡æ‡¶è¼‰å…¥æ•´åˆ

### 4. æ•ˆèƒ½æ¸¬è©¦

**è¨˜æ†¶é«”ä½¿ç”¨æ¸¬è©¦**
- æ¸¬è©¦ IntersectionObserver è¨˜æ†¶é«”æ´©æ¼
- æ¸¬è©¦çµ„ä»¶å¸è¼‰æ¸…ç†

**è¼‰å…¥æ™‚é–“å„ªåŒ–æ¸¬è©¦**
- æ¸¬è©¦å¯è¦‹åœ–ç‰‡å„ªå…ˆè¼‰å…¥
- æ¸¬è©¦å¿«é€Ÿæ»¾å‹•æ•ˆèƒ½

**ç¶²è·¯æ•ˆç‡æ¸¬è©¦**
- æ¸¬è©¦æ‰¹æ¬¡è«‹æ±‚è™•ç†
- æ¸¬è©¦è³‡æºæ¸…ç†

## ğŸ› ï¸ æ¸¬è©¦å·¥å…·å‡½æ•¸

### `createMockIntersectionObserver`
```typescript
const MockObserver = createMockIntersectionObserver(isIntersecting, delay);
```
å‰µå»ºæ¨¡æ“¬çš„ IntersectionObserverï¼Œå¯æ§åˆ¶æ˜¯å¦ç›¸äº¤å’Œå»¶é²æ™‚é–“ã€‚

### `mockImageLoad`
```typescript
const cleanup = mockImageLoad(shouldSucceed, delay);
```
æ¨¡æ“¬åœ–ç‰‡è¼‰å…¥ï¼Œå¯æ§åˆ¶æˆåŠŸ/å¤±æ•—å’Œè¼‰å…¥æ™‚é–“ã€‚

### `mockNetworkConnection`
```typescript
const cleanup = mockNetworkConnection('4g' | '3g' | '2g' | 'slow-2g');
```
æ¨¡æ“¬ä¸åŒçš„ç¶²è·¯é€£æ¥é¡å‹ã€‚

### `waitForAsync`
```typescript
await waitForAsync(100); // ç­‰å¾… 100ms
```
ç­‰å¾…ç•°æ­¥æ“ä½œå®Œæˆã€‚

## ğŸ“Š æ¸¬è©¦è¦†è“‹ç‡ç›®æ¨™

- **å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡**: > 90%
- **æ•´åˆæ¸¬è©¦è¦†è“‹ç‡**: > 80%
- **é—œéµè·¯å¾‘è¦†è“‹ç‡**: 100%

## ğŸ› èª¿è©¦æ¸¬è©¦

### æŸ¥çœ‹æ¸¬è©¦è¼¸å‡º
```bash
# è©³ç´°è¼¸å‡ºæ¨¡å¼
npm run test -- --reporter=verbose

# åªé‹è¡Œå¤±æ•—çš„æ¸¬è©¦
npm run test -- --reporter=verbose --run-failed
```

### èª¿è©¦ç‰¹å®šæ¸¬è©¦
```bash
# é‹è¡Œç‰¹å®šæ¸¬è©¦æ–‡ä»¶
npm run test -- useIntersectionObserver.test.ts

# é‹è¡Œç‰¹å®šæ¸¬è©¦æ¡ˆä¾‹
npm run test -- --grep "should load and display image"
```

## ğŸ” å¸¸è¦‹å•é¡Œ

### Q: IntersectionObserver æ¸¬è©¦ä¸ç©©å®šï¼Ÿ
A: ç¢ºä¿ä½¿ç”¨ `createMockIntersectionObserver` ä¸¦è¨­å®šé©ç•¶çš„å»¶é²æ™‚é–“ã€‚

### Q: åœ–ç‰‡è¼‰å…¥æ¸¬è©¦å¤±æ•—ï¼Ÿ
A: æª¢æŸ¥ `mockImageLoad` çš„è¨­å®šï¼Œç¢ºä¿ `cleanup` å‡½æ•¸åœ¨æ¸¬è©¦çµæŸæ™‚è¢«å‘¼å«ã€‚

### Q: æ•´åˆæ¸¬è©¦è¶…æ™‚ï¼Ÿ
A: å¢åŠ  `waitFor` çš„è¶…æ™‚æ™‚é–“ï¼Œæˆ–æª¢æŸ¥æ¨¡æ“¬çš„ API å›æ‡‰ã€‚

## ğŸ“ˆ æ•ˆèƒ½åŸºæº–

- **åˆå§‹è¼‰å…¥æ™‚é–“**: < 2 ç§’
- **åœ–ç‰‡æ‡¶è¼‰å…¥è§¸ç™¼**: < 100ms
- **è¨˜æ†¶é«”ä½¿ç”¨**: ç©©å®šï¼Œç„¡æ´©æ¼
- **ç¶²è·¯è«‹æ±‚**: æ‰¹æ¬¡è™•ç†ï¼Œä¸è¶…éä¸¦ç™¼é™åˆ¶

## ğŸš€ æŒçºŒæ”¹é€²

å®šæœŸé‹è¡Œæ•ˆèƒ½æ¸¬è©¦ï¼Œç›£æ§ï¼š
1. è¼‰å…¥æ™‚é–“è¶¨å‹¢
2. è¨˜æ†¶é«”ä½¿ç”¨æƒ…æ³
3. ç¶²è·¯è«‹æ±‚æ•ˆç‡
4. ä½¿ç”¨è€…é«”é©—æŒ‡æ¨™

é€šéæ¸¬è©¦ç¢ºä¿æ‡¶è¼‰å…¥åŠŸèƒ½åœ¨å„ç¨®ç’°å¢ƒä¸‹éƒ½èƒ½æä¾›æœ€ä½³çš„ä½¿ç”¨é«”é©—ã€‚
